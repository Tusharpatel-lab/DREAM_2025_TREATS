FROM python:3.10-slim

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies
RUN pip install --no-cache-dir \
    numpy==1.24.3 \
    pandas==2.0.3 \
    scipy==1.10.1 \
    scikit-learn==1.3.0 \
    anndata==0.9.2 \
    xgboost==1.7.6 \
    h5py==3.9.0 \
    tables==3.8.0

# Copy the script to the container
COPY run_task1.py /app/run_task1.py

# Make the script executable
RUN chmod +x /app/run_task1.py

# Create directories for input/output
RUN mkdir -p /input /output /usr/local/bin

# Copy model files (you'll need to add these)
COPY gene_order.pkl /usr/local/bin/
COPY Submission_model1_ADNC.json /usr/local/bin/
COPY Submission_model1_Braak.json /usr/local/bin/
COPY Submission_model1_CERAD.json /usr/local/bin/
COPY Submission_model1_Thal.json /usr/local/bin/
COPY Submission_model1_ADNC_level.pkl /usr/local/bin/
COPY Submission_model1_Braak_level.pkl /usr/local/bin/
COPY Submission_model1_CERAD_level.pkl /usr/local/bin/
COPY Submission_model1_Thal_level.pkl /usr/local/bin/

# Set default volumes
VOLUME ["/input", "/output"]

# Set the default command
ENTRYPOINT ["python", "/app/run_task1.py"]
CMD ["--input", "/input", "--output", "/output"]